# Schema Compliance Summary

## MultiFlexi Report Schema Compliance

All tools now output reports that comply with the MultiFlexi report schema:
https://raw.githubusercontent.com/VitexSoftware/php-vitexsoftware-multiflexi-core/refs/heads/main/multiflexi.report.schema.json

### Schema Requirements

#### Required Fields
- ✅ `status` (string): "success", "error", or "warning"
- ✅ `timestamp` (string): ISO8601 date-time format

#### Optional Fields
- ✅ `message` (string): Human-readable message
- ✅ `artifacts` (object): Keys map to arrays of strings (file paths, URLs)
- ✅ `metrics` (object): Keys map to scalar values (number, integer, or string)

### Implementation

#### raiffeisenbank-balance.php
```json
{
    "status": "success",
    "timestamp": "2025-10-22T10:30:00+00:00",
    "message": "Balance retrieved successfully",
    "artifacts": {
        "balance": ["output_file.json"]
    },
    "metrics": {
        "account_number": "123456789",
        "bank_code": "5500",
        "czk_clab": 5883.89,
        "czk_clbd": 5883.89,
        "eur_clab": 133.76
    }
}
```

#### raiffeisenbank-transaction-report.php
```json
{
    "status": "success",
    "timestamp": "2025-10-22T10:30:00+00:00",
    "message": "Report generated successfully",
    "artifacts": {
        "report": ["output_file.json"]
    },
    "metrics": {
        "in_total": 34,
        "out_total": 34,
        "in_sum_total": 313035.22,
        "out_sum_total": 347705.63,
        "account": "123456789",
        "iban": "CZ0000000000000000000000",
        "from": "2024-02-01",
        "to": "2024-03-31"
    }
}
```

#### raiffeisenbank-statement-downloader.php
```json
{
    "status": "success",
    "timestamp": "2025-10-22T10:30:00+00:00",
    "message": "Statements downloaded successfully",
    "artifacts": {
        "statements": [
            "/path/to/statement1.pdf",
            "/path/to/statement2.pdf"
        ]
    },
    "metrics": {
        "count": 2
    }
}
```

#### raiffeisenbank-statement-mailer.php
```json
{
    "status": "success",
    "timestamp": "2025-10-22T10:30:00+00:00",
    "message": "Statements mailed successfully",
    "artifacts": {
        "statements": [
            "/tmp/statement1.pdf",
            "/tmp/statement2.pdf"
        ]
    },
    "metrics": {
        "count": 2
    }
}
```

## MultiFlexi App Schema Compliance

All `multiflexi/*.app.json` files comply with the MultiFlexi app schema:
https://raw.githubusercontent.com/VitexSoftware/php-vitexsoftware-multiflexi-core/refs/heads/main/multiflexi.app.schema.json

### Validated Files
- ✅ `rb_balance.multiflexi.app.json` - Valid JSON, has all required fields
- ✅ `rb_statement_downloader.multiflexi.app.json` - Valid JSON, has all required fields
- ✅ `rb_statement_mailer.multiflexi.app.json` - Valid JSON, has all required fields
- ✅ `rb_transaction_report.multiflexi.app.json` - Valid JSON, has all required fields

### Required Fields (All Present)
- ✅ `$schema` - Schema reference URL
- ✅ `schemaVersion` - Version 3.0.0
- ✅ `uuid` - Unique identifier
- ✅ `name` - Localized name object
- ✅ `executable` - Command name

### Changes Made
- Changed `CERT_FILE` type from `string` to `file` in all configs for proper file handling

## Validation Status

| Component | Status | Notes |
|-----------|--------|-------|
| Report Schema Compliance | ✅ PASS | All scripts output schema-compliant reports |
| App Schema Compliance | ✅ PASS | All JSON configs have required fields |
| JSON Syntax | ✅ PASS | All JSON files are valid |
| PHP Syntax | ✅ PASS | All PHP files pass linting |

## Testing

To verify schema compliance manually:

```bash
# Validate JSON syntax
jq empty multiflexi/*.app.json

# Check PHP syntax
php -l src/*.php

# Run tools and check output format
cd src/
php raiffeisenbank-balance.php --output=/tmp/test.json --environment=../.env
jq . /tmp/test.json
```
